## 快速开始

下载[星夜引擎的发行版]()<br/><br/>
解压文件,打开引擎根目录下的`config.ini`,配置你的游戏信息<br/>
配置文件使用 ini 格式,`;`用于注释,在一行之内,`;`之后的内容会被引擎忽略

```ini
; 你的游戏名称,会显示在浏览器的标签页上
name=咸鱼生活
; 你的游戏ID,根据此ID寻找游戏存档,修改ID会导致已保存的存档丢失
; 如果在同一域名下有多个游戏,需要配置此项,否则可以保持默认
key=be2c8cd9-3f9b
; 起始页的背景，文件放在image文件夹
TitleImg=Title2.png
; 起始页的背景音乐，文件放在audio文件夹
TitleBGM=夏影.mp3
```

复制以下内容到引擎根目录下的`scenario.txt`

```ts
----
@对话 名称:"咸鱼" 文本:"Hello World!"
@背景 文件:"saltlife.jpg"
@立绘 名称:"咸鱼" 文件:"saltfish/fish.jpg" x:640 y:640
----
```

运行`Start.exe`,会自动打开浏览器(如果没有请手动[打开](localhost:8888))<br/>
请注意,这时 Start.exe 应该保持运行并显示在你的任务栏,如果没有,请参考[常见问题](#Start.exe运行异常)<br/>
点击"开始游戏",显示如下:($一张图片,之后截)

## 需要了解的概念

#### 命令:

参考接下来的"命令"部分,操作某个元素(如音乐,图片等)的指令就称为命令

#### 幕:

玩家的一次点击会执行一幕,在一幕中可以有任意多个命令<br/>
如果第二次点击时有命令还未执行完毕,则会将命令快进至结束而不会进入下一幕

## 剧本基本格式

星夜引擎的剧本格式如下所示

```ts
----
@命令名称 命令参数:参数值 命令参数:参数值 //注释
----
@命令名称 命令参数:参数值 命令参数:参数值
----
```

`----`用于分割不同的幕<br/>
`//`用于注释,在一行之内,`//`之后的内容会被引擎忽略<br/>

举个实际栗子

```ts
----
@背景 文件:"saltlife.jpg"
@立绘 名称:"咸鱼" 文件:"saltfish/fish.jpg" x:640 y:640
----
@对话 名称:"咸鱼" 文本:"啊这...\n摸了!" //完工,睡觉
----
```

命令参数的顺序是随意的,一行也可以有多条命令,所以下面这样写也是正确的<br/>
不过,推荐每行只写一条命令,并且使用一个固定的参数顺序

```ts
@背景 文件:"saltlife.jpg" @立绘 文件:"saltfish/fish.jpg" x:640 名称:"咸鱼" y:640
```

## 参数类型

星夜引擎的命令参数有三种类型,分别为`文本` `数字` `是否`<br/>

### 文本

一段文本,需要使用`""`包裹<br/>
你也可以使用中文引号`“”`<br/>
在文本中可以使用`\n`来换行,也可以直接换行,如果想在`""`包裹的文本中使用`"`,则需要写成`\"`,`\`则写为`\\`<br/>
这在编程世界被称为**转义字符**,是一种常见的避免歧义的方式<br/>
在这里提到的转义字符应该能满足你的需要,可以阅读[转义字符](#转义字符)章节获取更多信息

### 数字

一个数字,如`50`、`1.2`

### 是否

条件变量,`true`(是)或`false`(否)

## 命令参数

星夜引擎有一些常见的参数命名,以下说明它们代表的含义

### 名称

给当前命令操作的元素命名,如[放置立绘](#放置立绘)<br/>
也可能直接显示在游戏上,[显示对话](#显示对话)<br/>
这个参数是一个文本

### 目标

在一个命令为元素命名后,使用这个参数来明确"我要操作目标元素"<br/>
这个参数是一个文本

### 文件

告诉命令要使用哪个文件,或者,如果你想更详细的区分文件类型,你也可以使用`音频` `视频` `图片` 它们完全等价于 `文件`<br/>
可以使用`/`表达引擎目录下的子文件夹,比如`saltfish/fish.jpg`代表引擎目录下`saltfish`文件夹中的`fish.jpg`<br/>
这个参数是一个文本

### 空间参数

包含 `x`、`y`、`w`、`h`、`z`,在如[放置立绘](#放置立绘)等图像操作的命令中应用<br/>
`x`、`y`:相对于游戏画面左上角的坐标<br/>
`w`、`h`:图片的宽度和高度<br/>
`z`:图层的顺序,z 值大的图片会在 z 值小的图片前面显示<br/>
这个参数是一个数字

### 时间

持续时间,淡入时间,等待时间等等,都属于这个参数<br/>
目前,这个参数的单位是**毫秒**,1秒等于1000毫秒<br/>
这个参数是一个数字

### 缓动

缓动函数是一种算法,可以实现淡入淡出等效果<br/>
本引擎使用`anime.js`实现缓动效果<br/>
你可以参考[缓动函数速查表](https://www.xuanfengge.com/easeing/easeing/),填入链接展示的缓动函数之一,如`easeInSine`<br/>
或者,你也可以查看[animejs参考文档](https://animejs.com/documentation)中的`Easings`篇,了解本引擎支持的全部缓动种类<br/>
这个参数是一个字符串

## 命令

### 对话和语音

#### 命令名称`@对话`

| 参数 |          功能          |
| ---- | :--------------------: |
| 文本 |   在对话框中展示文本   |
| 名称 | 在对话框中展示角色名称 |
| 文件 |      播放角色语音      |

使用演示

```ts
@对话 名称:鸽子 文本:咕咕咕 文件:咕.mp3
```

其中`名称`和`文件`可选,所以你也可以这样写

```ts
@对话 文本:咕咕咕
```

如果你省略了名称参数,它将继承前一幕的名称<br/>
如果你想将对话框中的人物名称设置为空,则需要这样写: `名称:""`<br/>

### 更改背景

### 放置立绘

### 关闭立绘

### 解锁 cg

### 移动图片元素

### 抖动图片元素

### 播放背景音乐

### 播放环境音

### 播放音频

### 播放视频

### 跳转选项与跳转标识

### 等待

#### 使用等待处理特殊情况

## 拆分剧本

在 scenario.txt 的第一行中标识剧本顺序,举例

```haskell
咕咕咕.txt => gugu.txt => 场景3.txt
=> 场景4.txt => 场景5.txt
```

可以在`=>`两端使用空格使格式更整齐,但这不是必须的<br/>
之后不要在 scenario.txt 中写其他字符了,否则可能会引发错误

## 使用智能提示

只需要安装[VSCode](),并在 VSCode 中安装[插件](),即可使用提示功能<br/>
在剧本中输入@即可获得所有命令的提示,用 ↑↓ 键选择一个命令,按 Enter 键输入<br/>
这时光标会自动移动到第一个参数处并给出可能的提示,输入参数的值,按 Tab 键即可切换到下一个参数<br/>
如果你同时有其他代码编写需求,可以把剧本的格式从.txt 改为.ses,并在插件中设置"代码提示"<br/>
这个插件还提供一定的语法高亮和错误检查功能<br/><br/>
另外,VSCode 本身也支持一些方便的快捷键,具体可以查找[百度](https://www.baidu.com/s?wd=vscode%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE)<br/>
猜测可能常用以下快捷键

```
向上/向下移动行 Alt+ ↑ / ↓
向上/向下复制行 Shift+Alt + ↓ / ↑
在文件内查找替换 Ctrl + F
```

## 命令调用链

## 别名(宏)

::: warning 注意
$这部分教程已经部分过时,现在剧本不再支持不带引号""的字符串了
:::
在 userData 文件夹中的 macro.txt 配置宏,你应该会看到很多已经配置好的宏<br/>
新建一个空白行以编写你自己的宏

### 配置与使用

宏在剧本中有非常丰富的应用场景,星夜引擎的宏定义方式如下

```ts
结果字符串 => 原字符串 //宏支持注释
烤{str}串 => 羊肉{str}串 //宏支持插值表达式
```

一行定义一个宏,如果宏中需要换行使用`\n`<br/>
`=>`两侧的空格是必须的<br/>
以上两个宏应用在剧本中会产生这样的效果

```ts
//你看到的剧本
@对话 文本:结果字符串
@对话 文本:烤白薯串
//编译结果
@对话 文本:原字符串
@对话 文本:羊肉白薯串
```

如果宏要操作一个被`""`包裹的文本,需要使用插值语法`{{}}`

```wiki
@对话 文本:"结果字符串{{结果字符串}}"
```

这段剧本的编译结果为

```
@对话 文本:"结果字符串原字符串"
```

宏在"[宏在引擎中的应用](#宏在引擎中的应用)"中还有丰富的使用实例

### 使用英文命令和英文参数

只需在 macro.txt 中删除`//中文转换`以下的所有预定义宏即可,如果你已经对宏有足够的了解,也可以按需删除

### 使用其他风格的命令语法

星夜引擎提供了一些其他风格的命令语法,要注意的是,这些语法风格并不能被星夜引擎的[提示插件](#使用智能提示)很好的识别<br/>
[下载]()对应的宏定义并添加到 macro.txt 即可使用

#### WebGAL 风格

格式:`command:content -parameter1 -parameter2=argument ......;`<br/>
这个风格不支持自定义的参数顺序,但是也不需要关心参数的名称<br/>

### 宏在引擎中的应用

::: tip 注意
这是一个扩展内容
:::

## 转义字符
