::: tip 注意
剧本是基于 JavaScript 的，但无需担心 —— 即使没有相关基础，只需花几分钟学习[基础语法](/guide/scenario/code)即可轻松上手剧本编写。
:::

游戏的剧本应该放置于 `scenario` 文件夹中，游戏的资源应该放置于 `public/static` 文件夹中。

## 对话

对话是视觉小说中最高频的结构，所以拥有特殊简化的语法。

一条对话由三个部分组成，`角色名称` `:` `"对话文本"` `+` `"对话配音"`。

同一角色的多段对话可以省略角色名称，它将继承前一段对话的角色名称。

如果没有配音文件，也可以省略它。

```ts
'……我将踏上一段愉快的旅程。'
诺瓦: '……我将踏上一段愉快的旅程。' + '/AudioClip/noi0001.flac'
诺瓦: '……我将踏上一段愉快的旅程。'
'……我将踏上一段愉快的旅程。' + '/AudioClip/noi0001.flac'
```

简化形式对话的角色名称部分是由 JavaScript 的标签实现的，所以在遇到特殊字符，如中文问号时，可能需要使用[对话的命令形式](/guide/scenario/api#对话)。

以数字开头或者空白的标签也是不合法的，为了使简化形式更加通用，角色名称开头的第一个 `$` 被视作空白，你可以使用 `$:` 切换到没有人物名称的旁白。

可以通过 [HTML](/guide/scenario/code#html) 自定义文本样式，在简化形式对话中使用这项功能需要 `jsx` 或 `tsx` 格式的剧本。

```tsx
Message:<span style="color: red">
    这是一条<b>重要</b>的消息，需要你<i>特别</i>留意。
    下面的内容<u>请务必关注</u>，不要理会<s>已经废弃</s>的提示。
</span> + '0001.mp3'
```

## 命令

使用命令操作舞台中的元素，基本格式是：`$模式.命令名称(命令参数)`

`模式` 表示命令的执行方式，分为以下两种：

-   `$执行` 表示执行本条命令并立即继续向下执行
-   `$等待` 表示等待本条命令完成后继续向下执行

不同命令支持的模式不同，有些可以选择两种模式之一，有些只能等待或不能等待。

## 幕

幕是剧情的基本单元，由若干条命令组成，幕中的命令执行完毕后，将等待用户点击进入下一幕。

编写对话将自动划分幕，也可以使用 `$action` 手动划分幕，在划分第 1 幕之前，称为第 0 幕，可以用于设置舞台的初始状态。

```ts
$执行.命令() // 第0幕
诺瓦: '……我将踏上一段愉快的旅程。' // 第1幕
$执行.命令() // 第1幕
'……与你一同的旅程。' // 第2幕
'无论何时……都与你一起……' // 第3幕
```

## 剧本

剧本文件的命名格式为 `*.scenario.(mjs|js|mts|ts|jsx|tsx)`，例如 `story.scenario.ts`。

`.scenario` 表示这是一个剧本文件，`.ts` 后缀表示所使用的 JavaScript 方言。

可以在剧本中使用完整的 JavaScript 语法，包括变量、条件和循环语句等，同时也可以使用对应方言的特性，比如 TypeScript 的类型标注。

剧情将从入口文件 `scenario/index.scenario.(mjs|js|mts|ts|jsx|tsx)` 开始。

### 拆分剧本

在剧本中使用 `$include` 将指定剧本的内容嵌入。

```ts
// scenario/index.scenario.tsx
诺瓦: '……我将踏上一段愉快的旅程。' // 第1幕
$include('./example.scenario.tsx')
$执行.命令() // 第2幕
```

```ts
// scenario/example.scenario.tsx
$执行.命令() // 第1幕
'……与你一同的旅程。' // 第2幕
```

### 调试剧本

在剧本中使用 `$debugger` 让剧情从指定位置开始。

```ts
$执行.命令()
诺瓦: '……我将踏上一段愉快的旅程。'
$执行.命令()
'……与你一同的旅程。'
$debugger // 剧情将从这里开始
'无论何时……都与你一起……'
```

### 内置变量

在剧本中使用 `$store` 访问包括设置，存档在内的全部游戏数据。

```ts
system: `当前游戏名称为：${$store.system.name}`
```

在剧本中使用 `$context` 访问游戏实例当前的运行时数据。

```ts
system: `当前游戏状态为：${$context.state.now()}`
```

## 参数

本章节介绍一些常见的命令参数。

### 标识符

标识符，或者说 ID，用于后续操作时引用这个元素。

### 作用目标

操作元素的命令使用这个参数，填入目标的标识符。

### 持续时间

持续时间参数的单位为毫秒，具体所指参看命令说明。

### 资源路径

`public/static` 文件夹中的资源，填写时由 `/` 开头。

比如 `public/static/咕.mp3` ，填写为 `/咕.mp3` 。
